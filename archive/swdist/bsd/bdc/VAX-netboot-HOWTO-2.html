<HTML>
<HEAD>
<TITLE>The VAX Network Booting HOWTO: Getting Your System up to Speed</TITLE>
</HEAD>
<BODY>
<A HREF="VAX-netboot-HOWTO-1.html">Previous</A>
<A HREF="VAX-netboot-HOWTO-3.html">Next</A>
<A HREF="VAX-netboot-HOWTO.html#toc2">Table of Contents</A>
<HR>
<H2><A NAME="get-up-to-spd"></A> <A NAME="s2">2. Getting Your System up to Speed</A></H2>


<P>This section provides information on adding any missing pieces your
operating system may require in order to get it to properly function
as a bootserver environment for your VAX.  Of the several operating
systems VAX bootserving has been set up on, only Linux and FreeBSD
require any noteworthy additions.  Both NetBSD and OpenBSD have all
the components necessary for netbooting preloaded.  If you're planning
on using NetBSD or OpenBSD for your bootserver, you may move on to the
<A HREF="VAX-netboot-HOWTO-3.html#boot-config">Bootserver Configuration</A>
section of the HOWTO at this time.</P>


<H2><A NAME="linux-mods"></A> <A NAME="ss2.1">2.1 Modifications for Linux</A></H2>

<P>Unfortunately your ordinary distribution of Linux is somewhat short
on utilities for adequately netbooting NetBSD on DEC VAX hardware.
But thanks to the BSD people, all the necessary networking software
resources are ready to hijack.  In fact, all the needed software pieces
have already been modified to run under Linux -- you just have to go
out and gather them up.</P>


<H3><A NAME="linux-kern-prep"></A> Preparing Your Linux Kernel</H3>

<P>There are a couple of things which need to be included your Linux
kernel in order for netbooting to work properly.</P>
<P><B>RARP</B></P>

<P>First you need to make sure you've got RARP support compiled in.  If
the file /proc/net/rarp doesn't exist then you need to do one of two
things: (1) It may be that RARP was compiled as a loadable module for
your kernel.  If this is the case then you'll need to `insmod' the
/lib/modules/<EM>(linux version)</EM>/ipv4/rarp.o module.  (2) If you
don't already have RARP compiled into your kernel, you will need to
reconfigure and recompile Linux with RARP support added.  Since the
RARP code is small, I recommend just compiling it directly into the
kernel.</P>
<P><B>Multicast</B></P>
<P>In addition to RARP, it is also recommended that you compile in the IP
multicast code for Linux.</P>
<P>Compiling in IP multicast was how I initially got my network interface
to operate in promiscuous mode.  There's an easier way to achieve the
same effect and that is with the command `ifconfig eth0 allmulti'
which according to the ifconfig man page does the following:</P>
<P>
<PRE>
[-]allmulti
    Enable  or  disable  the  promiscuous  mode  of the
    interface.  This means that all incoming frames get
    sent  to  the  network  layer of the system kernel,
    allowing for networking monitoring.
</PRE>
</P>
<P>Running the network interface in promiscuous mode is necessary for the
MOP server software which will be discussed later in this guide.</P>
<P>There is some still some speculation (on my part at least) about the
necessity of compiling in multicast support.  I've found that I don't
need it with the Linux driver for my NE2000 clone card.  Other network
card drivers may behave differently (more speculation on my part).  I
guess more research and knowledge is required.</P>
<P>Unless you know otherwise, go ahead and compile your Linux kernel with
IP multicast support.  There's no harm in doing it.</P>


<H3><A NAME="linux-add-soft"></A> Obtaining Additional Software Needed by Linux</H3>

<P>Before you begin, you'll need to grab all the necessary components to
turn your Linux system into a lean mean netbooting machine.</P>
<P><B>The MOP Server</B></P>
<P>The MOP server that Linux uses is the same MOP server used by the BSDs,
only it has some modifications to allow it to run under Linux. The MOP
server is used by the VAX client to load the NetBSD/vax bootloader.</P>
<P>The MOP Server software for Linux is available from: </P>
<P>
<A HREF="ftp://ftp.stacken.kth.se/pub/OS/NetBSD/mopd/mopd-linux-2.5.3.tar.gz">ftp://ftp.stacken.kth.se/pub/OS/NetBSD/mopd/mopd-linux-2.5.3.tar.gz</A></P>
<P>
<A HREF="ftp://ftp.canberra.edu.au/pub/ise/linux-vax/tools/mopd/mopd-linux-2.5.3.tar.gz">ftp://ftp.canberra.edu.au/pub/ise/linux-vax/tools/mopd/mopd-linux-2.5.3.tar.gz</A></P>
<P><B>Building The MOP Server</B></P>
<P>The MOP server software is contained in the file
<CODE>mopd-linux-2.3.5.tar.gz</CODE> which you have hopefully grabbed
already.</P>
<P>Extracting the files from this archive will create a
<CODE>./mopd-linux</CODE> directory which in turn contains a
<CODE>README</CODE>, a common code directory, and directories for the
various utilities of the mopd package.  At this point we're only concerned
with the mopd directory which contains the source code for the MOP
server.  The other directories contain the code for various MOP server
debugging utilities.</P>
<P>Run `make' inside the <CODE>./mopd-linux/mopd</CODE> directory.  This will
build the mopd MOP server daemon.</P>
<P><B>Installing The MOP Server</B></P>
<P>I choose to place the MOP server in the <CODE>/usr/local/sbin</CODE>
directory on my Linux system.  You may place them where ever it makes
the most sense to you, but the examples in the remainder of the HOWTO
will assume that the executables reside in <CODE>/usr/local/sbin</CODE>.</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
# mkdir -p /usr/local/sbin
# cp ./mopd-linux/mopd/mopd /usr/local/sbin
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P><B>The bootparamd Server</B></P>
<P>If your Linux distribution didn't come with a bootparamd or an
rpc.bootparamd daemon then you'll need to get one.  The RedHat 5.0
Linux distribution comes with a bootparamd server, but my RedHat 4.0
installed system didn't have one.  If you're running on a system which
does have the daemon, then move on to the 
<A HREF="VAX-netboot-HOWTO-3.html#boot-config">Bootserver Configuration</A> section. It's likely that a number of
other distributions are missing this server daemon.  No problem
though, you just need to pick up an old version of NetKit for Linux:</P>
<P>
<A HREF="ftp://ftp.uk.linux.org/pub/linux/Networking/base/attic/NetKit-0.09.tar.gz">ftp://ftp.uk.linux.org/pub/linux/Networking/base/attic/NetKit-0.09.tar.gz</A></P>
<P><B>Building The bootparamd Server</B></P>
<P>The bootparamd server <CODE>rpc.bootparamd</CODE> is contained in the
<CODE>NetKit-0.09.tar.gz</CODE> file.</P>
<P>Extracting the files from this archive will give you the
<CODE>./NetKit-0.09</CODE> directory which in turn contains a number of
other directories containing network servers and utils.  We're only
interested in two of the directories: <CODE>rpcgen</CODE> and
<CODE>rpc.bootparamd</CODE>.  The first, <CODE>rpcgen</CODE>, contains the
source for a utility needed for the compilation of the
<CODE>rpc.bootparamd</CODE> server.  The second directory,
<CODE>rpc.bootparamd</CODE>, appropriately contains the source for the
bootparamd server.</P>
<P>Run `make' inside of <CODE>./NetKit-0.09/rpcgen</CODE> and then run `make'
inside of <CODE>./NetKit-0.09/rpc.bootparamd</CODE>.  This will build the
bootparamd server daemon.</P>
<P><B>Installing The bootparamd Server</B></P>
<P>Copy the bootparamd server into <CODE>/usr/local/sbin</CODE>, or which
ever location you are using to hold these non standard server daemons.
The remainder of the HOWTO will assume that you've copied them to
<CODE>/usr/local/sbin</CODE>.</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
# cp ./NetKit-0.09/rpc.bootparamd/bootparamd /usr/local/sbin
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P><EM>You may continue on to 
<A HREF="VAX-netboot-HOWTO-3.html#boot-config">Bootserver Configuration</A></EM></P>


<H2><A NAME="freebsd-mods"></A> <A NAME="ss2.2">2.2 Modifications for FreeBSD (Contributed by Kevin McQuiggin)</A></H2>

<P>Before you begin, you'll need to get a copy of the mopd MOP server
daemon to allow your FreeBSD system to operate as a bootserver.</P>
<P><B>The MOP Server</B></P>
<P>The MOP server used is the standard MOP server used by the other BSD
derived systems like NetBSD and OpenBSD. Depending on the version of
FreeBSD you're running, modifications to the mopd source may be
necessary. The MOP server is used by the VAX client to load the
NetBSD/vax bootloader.</P>
<P>The MOP Server software is available from: </P>
<P>
<A HREF="ftp://ftp.stacken.kth.se/pub/OS/NetBSD/mopd/mopd-2.5.3.tar.gz">ftp://ftp.stacken.kth.se/pub/OS/NetBSD/mopd/mopd-2.5.3.tar.gz</A></P>
<P><B>Building The MOP Server</B></P>
<P>The MOP server software is contained in the file
<CODE>mopd-2.3.5.tar.gz</CODE> which you have hopefully grabbed already.</P>
<P>Version 2.5.3 of mopd is configured for use with FreeBSD versions 2.1
and lower. If you are running FreeBSD 2.2 or later then you have to
make some minor changes to one of mopd's source files. The next
release of mopd will fix this, but for now here are the changes you
must make.</P>
<P>The file that must be modified is <CODE>put.c</CODE>. It is in the mopd
distribution's <CODE>./mopd-2.5.3/common</CODE> directory. Add the
following 3 lines to the #includes section at the start of the file:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
#ifdef __FreeBSD__
#include &lt;osreldate.h&gt;
#endif
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Next, there are 2 places within the file where the symbol
<CODE>__FreeBSD__</CODE> is checked to see if it is defined:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
#if !defined(__FreeBSD__)
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Change each of these lines to:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
#if !defined(__FreeBSD__) || __FreeBSD_version &gt;= 220000
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Make the appropriate changes to the <CODE>put.c</CODE> if you're running a
version of FreeBSD greater than 2.1.  Then switch to the mopd daemon's
directory and build the mopd daemon.</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
# cd ./mopd-2.5.3/mopd
# make
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>This will rebuild a usable copy of mopd for use with FreeBSD versions
2.2 and later.</P>
<P><B>Installing The MOP Server</B></P>
<P>Now that you've built your mopd server daemon, I suggest copying it
into <CODE>/usr/local/sbin</CODE>.  You may place the server where ever it
makes the most sense to you, but the examples in the remainder of the
HOWTO will assume that the mopd executable resides in
<CODE>/usr/local/sbin</CODE>.</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
# mkdir -p /usr/local/sbin
# cp ./mopd-2.5.3/mopd/mopd /usr/local/sbin
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P><EM>You may continue on to 
<A HREF="VAX-netboot-HOWTO-3.html#boot-config">Bootserver Configuration</A></EM></P>


<H2><A NAME="solaris-mods"></A> <A NAME="ss2.3">2.3 Modifications for Solaris <EM><F>not completed</F></EM></A></H2>




<H2><A NAME="irix-mods"></A> <A NAME="ss2.4">2.4 Modifications for IRIX <EM><F>not completed</F></EM></A></H2>




<H2><A NAME="next-mods"></A> <A NAME="ss2.5">2.5 Modifications for NeXTSTEP <EM><F>not completed</F></EM></A></H2>





<HR>
<A HREF="VAX-netboot-HOWTO-1.html">Previous</A>
<A HREF="VAX-netboot-HOWTO-3.html">Next</A>
<A HREF="VAX-netboot-HOWTO.html#toc2">Table of Contents</A>
</BODY>
</HTML>
