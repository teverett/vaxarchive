<HTML>
<HEAD>
<TITLE>The VAX Network Booting HOWTO: Bootserver Configuration</TITLE>
</HEAD>
<BODY>
<A HREF="VAX-netboot-HOWTO-2.html">Previous</A>
<A HREF="VAX-netboot-HOWTO-4.html">Next</A>
<A HREF="VAX-netboot-HOWTO.html#toc3">Table of Contents</A>
<HR>
<H2><A NAME="boot-config"></A> <A NAME="s3">3. Bootserver Configuration</A></H2>

<P>The following section covers the details of setting up your own
bootserver machine using the operating system of your choice.  The
configuration steps for all of the operating systems are nearly
identical. But in the cases where there are exceptions, those
exceptions are noted.</P>
<P>You will need to obtain copies of the NetBSD/vax bootloader in MOP
format, the NetBSD/vax kernel, and the NetBSD/vax system binaries.
Beyond this you will also need to configure a number of your
bootserver's system files.</P>

<H2><A NAME="obtain-images"></A> <A NAME="ss3.1">3.1 Obtaining The NetBSD/vax Kernel and MOP Bootloader Images</A></H2>

<P>These files are arguably the most critical for booting up your
VAX client system.  <EM>You really need them.</EM></P>
<P>The files required for netbooting live at the following location(s):</P>
<P><B>MOP format bootloader image</B></P>
<P>
<A HREF="ftp://ftp.netbsd.org/pub/NetBSD/NetBSD-1.3/vax/installation/netboot/boot.mopformat">ftp://ftp.netbsd.org/pub/NetBSD/NetBSD-1.3/vax/installation/netboot/boot.mopformat</A></P>
<P><B>NetBSD/vax Kernel</B></P>
<P>
<A HREF="ftp://ftp.netbsd.org/pub/NetBSD/NetBSD-1.3/vax/binary/kernel/gennetbsd.gz">ftp://ftp.netbsd.org/pub/NetBSD/NetBSD-1.3/vax/binary/kernel/gennetbsd.gz</A></P>



<H2><A NAME="vax-bin"></A> <A NAME="ss3.2">3.2 Obtaining The NetBSD/vax Binaries</A></H2>

<P>These are files which make NetBSD useful to the mere mortal user who
is looking to run NetBSD as useful Unix system.  The basic guts of a
Unix system are provided along with the all-important GNU development
tools. </P>
<P>The files you need are located at:</P>
<P>
<A HREF="ftp://ftp.netbsd.org/pub/NetBSD/NetBSD-1.3/vax/binary/sets/">ftp://ftp.netbsd.org/pub/NetBSD/NetBSD-1.3/vax/binary/sets/</A></P>
<P>Grab all the files in this directory.  <EM>(Just so you know, it's
about 36Megs worth of gzipped tar files).</EM> Setting aside the files
you've collected above, we now move on to some basic modifications of
the bootserver system files.</P>


<H2><A NAME="edit-files"></A> <A NAME="ss3.3">3.3 Editing Some Relevant Files</A></H2>

<P><B><CODE>/etc/hosts</CODE></B></P>
<P>You'll need to add an entry to your bootserver's <CODE>/etc/hosts</CODE>
file reflecting the IP address and hostname you're intending to use
for your VAX.  So I guess now would be a good time to figure out which
IP address you're going to give the machine and what you're going to
name it.  Throughout this document I refer to the netboot VAX client
as `vaxclient' and the bootserver as `bootserver'.</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
# /etc/hosts example file
#
127.0.0.1       localhost

# other machines on my network
10.3.250.2      bootserver.test.net bootserver
10.3.250.3      junk.test.net junk

# added the VAX client (and friend)
10.3.250.5      vaxclient.test.net vaxclient
10.3.250.6      somevax.test.net somevax

# End of file
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P><B><CODE>/etc/ethers</CODE></B></P>
<P>Create an <CODE>/etc/ethers</CODE> file with an entry for the VAX.  The
format of <CODE>/etc/ethers</CODE> file entry is a single line with a
hardware ethernet address in colon separated form followed by the
machine name associated with that ethernet address.</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
# Example /etc/ethers file
08:00:2b:16:59:bb  vaxclient
8:0:2b:16:54:a     somevax

# End of file
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P><EM>See 
<A HREF="VAX-netboot-HOWTO-8.html#appendix-a">Appendix A</A> at the end of this guide
for information on obtaining your hardware ethernet address.</EM></P>


<H2><A NAME="mbli-dir"></A> <A NAME="ss3.4">3.4 Setting up The MOP Bootloader Image Directory</A></H2>

<P>The MOP server that we'll be making use of is the same for all the
systems represented in this guide.  By default the MOP server looks
for the MOP bootable images in the directory <CODE>/tftpboot/mop/</CODE>.
Make this directory and copy the file <CODE>boot.mopformat</CODE> which
you obtained earlier into the <CODE>/tftpboot/mop</CODE> directory.
Lastly, make a link from <CODE>boot.mopformat</CODE> to
<CODE>MOPBOOT.SYS</CODE>.  The link to <CODE>MOPBOOT.SYS</CODE> is needed for
the examples in the remainder of this document.</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
# mkdir -p /tftpboot/mop
# mv boot.mopformat /tftpboot/mop
# cd /tftpboot/mop
# ln -s boot.mopformat MOPBOOT.SYS
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>The MOP server daemon is very particular about the names being in all
uppercase and having the .SYS extension.</P>



<H2><A NAME="nfsroot-setup"></A> <A NAME="ss3.5">3.5 Setting up The VAX Client's NFS Root Directory and Swap File</A></H2>

<P>Now you'll need to set aside a place for holding the NetBSD snapshot
binaries on your bootserver machine.  This directory will be used by
your VAX client as it's root filesystem. I made the directory
<CODE>/export/vaxclient/root</CODE> and used it to hold all the binaries.</P>
<P>Make the <CODE>/export/vaxclient/root</CODE> directory, or whatever
directory you want to use, and unarchive all the NetBSD snapshot
binaries into that directory.  You'll need about 80Megs of free space
to hold the unarchived binaries so plan ahead.</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
# mkdir -p /export/vaxclient/root
# cd /export/vaxclient/root
# gzip -dc base.tgz | tar xvpf -
# gzip -dc comp.tgz | tar xvpf -
# gzip -dc etc.tgz | tar xvpf -
  etc...
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P><B>SPECIAL LINUX NOTE:</B> <EM>The standard owner and group names for
Linux don't match up with those of NetBSD.  What this means is that
when you untar the snapshot binaries on your Linux system, the
untarring process will create the files with uids mapping to the Linux
equivalent. The same holds for group id mappings.</EM></P>
<P><B><EM>Example:</EM></B> Under NetBSD the user `bin' has uid 3.
Under RedHat Linux the user `bin' has uid 1.  When you untar the
snapshot files on your Linux system, the tar command will extract
files in the archive belonging to `bin' with Linux's `bin' uid of 1.
Later when you boot NetBSD from the Linux NFS filesystem, the files
which should be owned by `bin' show up as being owned by the NetBSD
`daemon' user.  This is because `daemon' has uid 1 under NetBSD.  Your
NetBSD/vax system will still run, but you will experience difficulties
using setuid and setgid programs under normal user accounts. I first
noticed the problems with the NetBSD `ps' and `w' commands which are
supposed to be setgid for the group `kmem'. But because the uids used
were Linux uids, the programs were setuid to the group `wsrc'.
Grrrr. I've not found a way to cleanly get around this problem yet.</P>
<P>Next you'll need to place the NetBSD kernel image in this directory.
Uncompress the the <CODE>gennetbsd.gz</CODE> file you obtained earlier and
copy it into the file named <CODE>/export/vaxclient/root/netbsd</CODE>.</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
# gzip -dc gennetbsd.gz &gt; /export/vaxclient/root/netbsd
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>You'll also need to create a system swapfile for use by NetBSD.  I
placed it right in the <CODE>/export/vaxclient</CODE> directory as it
seemed like a good place to keep it.</P>
<P>To create a 16Meg swapfile, I used:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
# dd if=/dev/zero of=/export/vaxclient/swap bs=4096 count=4096
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Finally, you will need to create a <CODE>/dev/console</CODE> device file in the
VAX client's <CODE>/dev</CODE> directory.  The NetBSD/vax kernel will need
this when the system boots.  You'll need to make the device file on
the bootserver.</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
# cd /export/vaxclient/root/dev
# mknod console c 0 0
</PRE>
</CODE></BLOCKQUOTE>
</P>


<H2><A NAME="nfsroot-exp"></A> <A NAME="ss3.6">3.6 Setting up The NFS Root Directory for Export</A></H2>

<P>Depending on your operating system, the format of the <CODE>/etc/exports</CODE>
file can vary.  Presently there are two formats to deal with.</P>


<H3><A NAME="net-open-exp"></A> NetBSD and OpenBSD Exports File</H3>

<P>Edit your <CODE>/etc/exports</CODE> file to contain the information about
your VAX client's NFS root directory.</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
# Example /etc/exports for NetBSD and OpenBSD
/home
/share
/export/vaxclient/root  -maproot=root vaxclient.test.net
/export/vaxclient/swap  -maproot=root vaxclient.test.net
# end of /etc/exports
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>The options following the mount name specify full root access
privileges for the VAX client.  Full root access is required for the
netbooted VAX to function properly.  You should be aware that there
are some security risks in allowing root write access to NFS mounted
filesystems.  However, this guide assumes you're working within a
trusted environment.</P>
<P>As opposed to adding the line for the swap file separately, you could
have added the `-alldirs' flag to the list of options under the export
entry for <CODE>/export/vaxclient/root</CODE>.  But that may give you a
bit more than you bargain for.  See the manpage for exports(5) if
you're curious.  <EM>Having come over from Linux, Solaris, and IRIX --
I found the BSD NFS server behavior a bit different from what I was
used to.</EM></P>
<P><EM>You may continue on to 
<A HREF="#setup-bootparams">Setting Up /etc/bootparams</A>.</EM></P>

<H3><A NAME="linux-exp"></A> Linux Exports File</H3>

<P>Edit your <CODE>/etc/exports</CODE> file to contain the information about
the directory you intend to NFS export as the root filesystem for your
VAX.</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
# Example /etc/exports for Linux
/home
/share
/export/vaxclient/root   vaxclient.test.net(rw,no_root_squash)
/export/vaxclient/swap   vaxclient.text.net(rw,no_root_squash)
# end of /etc/exports
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>The options in `()' specify that full root access privileges are
allowed for the machine vaxclient.  This is necessary for the
netbooted VAX to function properly.  This does present some security
risks, but I'll operate under the assumption that you're in a fairly
trusted environment.</P>
<P>After making changes to <CODE>/etc/exports</CODE> you'll have to `kill
-HUP' your mountd and nfsd daemons so they re-read the
<CODE>/etc/exports</CODE> file.  Or you can go with the brute-force system
reboot if you prefer. (One prerequisite is that you're going to have
to be running all the appropriate NFS server daemons for NFS exporting
to work.)</P>
<P><EM>You may continue on to 
<A HREF="#setup-bootparams">Setting up /etc/bootparams</A>.</EM></P>


<H3>FreeBSD Exports File (Contributed by Kevin McQuiggin)</H3>

<P>FreeBSD only allows the export of entire filesystems, not
directories. In your <CODE>/etc/exports</CODE> file you must make sure
that the location in which you've stored the NetBSD/vax binaries is
specified in terms of its root filesystem, and NOT in terms of the
location of the NetBSD/vax directory.</P>
<P>If you've created a root directory for your NetBSD/Vax machine in
<CODE>/usr/export/vaxclient/root</CODE>, for example, then your
<CODE>/etc/exports</CODE> file must state the filesystem on which this
directory resides, and NOT the name of the directory itself.</P>
<P>To get an idea of how to create your exports file, take a look at your
current mount points:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
# mount
/dev/wd0a on / (local)
/dev/wd0s1f on /usr (local)
/dev/wd1c on /usr/home (local)
/dev/wd0s1e on /var (local)
procfs on /proc (local)
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>In this case, since <CODE>/usr/export/vaxclient/root</CODE> is part of the
<CODE>/usr</CODE> filesystem, the <CODE>/etc/exports</CODE> file must indicate
<CODE>/usr</CODE>, and NOT <CODE>/usr/export/vaxclient/root</CODE>:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
# cat /etc/exports
/usr -alldirs -maproot=root vaxclient.test.net 
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Unlike other versions of UNIX, the following will NOT work:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
# cat /etc/exports
/usr/export/vaxclient/root -alldirs -maproot=root vaxclient.test.net
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>This is because <CODE>/usr/export/vaxclient/root</CODE> is not a
filesystem in its own right, but a directory within another
filesystem.</P>
<P>Note that the `-alldirs' flag is required, this is because unlike
NetBSD and some other UNIX variants, FreeBSD will not allow
<CODE>/etc/exports</CODE> to contain references to files, only
filesystems. Access to the NetBSD/vax swap file is handled during the
startup of mountd below.</P>
<P><EM>You may continue on to 
<A HREF="#setup-bootparams">Setting up /etc/bootparams</A>.</EM></P>


<H2><A NAME="setup-bootparams"></A> <A NAME="ss3.7">3.7 Setting up <CODE>/etc/bootparams</CODE></A></H2>

<P>The <CODE>/etc/bootparams</CODE> file contains the information the
bootparamd server will pass along to the booting VAX client.  It
contains information about the netbooting machine's identity, where
it's NFS root filesystem is located, and where it's swapfile is
located.  You can also specify a dumpfile.</P>
<P>Each entry in the <CODE>/etc/bootparams</CODE> file consists of a single
line of text.</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
# Example /etc/bootparams
vaxclient root=bootserver:/export/vaxclient/root \
 swap=bootserver:/export/vaxclient/swap

# End of file
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>The man page for bootparams claims that you may continue the entry
across lines using the "\" continuation delimiter, but I haven't had
any success with using it under Linux at least.  I now habitually keep
each entry on a single line. (Just pretend that you don't see the "\"
used above in the example and that the line continues off the right
side of the page). </P>



<HR>
<A HREF="VAX-netboot-HOWTO-2.html">Previous</A>
<A HREF="VAX-netboot-HOWTO-4.html">Next</A>
<A HREF="VAX-netboot-HOWTO.html#toc3">Table of Contents</A>
</BODY>
</HTML>
